# RZWD:RADIATION - ç³»çµ±æ¶æ§‹æ–‡ä»¶

> æ­¤æ–‡ä»¶ç”¨æ–¼è®“ AI åŠ©æ‰‹ï¼ˆå¦‚ Geminiï¼‰äº†è§£æ•´å€‹å°ˆæ¡ˆçš„æ¶æ§‹èˆ‡è„ˆçµ¡

---

## ğŸ“Œ å°ˆæ¡ˆæ¦‚è¿°

**RZWD:RADIATION**ï¼ˆè¼»å°„å€åŸŸæˆ°è¡“å°æŠ—ç³»çµ±ï¼‰æ˜¯ä¸€å€‹è³½åšæœ‹å…‹é¢¨æ ¼çš„**å³æ™‚ PvP NFC æ‰‹æ©ŸéŠæˆ²**ã€‚

ç©å®¶åˆ†ç‚ºä¸åŒ**é™£ç‡Ÿï¼ˆTEAMSï¼‰**é€²è¡Œå°æŠ—ï¼Œæ¯å€‹é™£ç‡Ÿæœ‰å…©ç¨®è§’è‰²ï¼š
- **OCCUPIERï¼ˆä½”é ˜è€…ï¼‰**ï¼šä½”é ˜è¼»å°„æº
- **SNIPERï¼ˆç‹™æ“Šæ‰‹ï¼‰**ï¼šå¹²æ“¾æ•µæ–¹ç©å®¶

### æ ¸å¿ƒè¡“èª
| èˆŠåç¨± | æ–°åç¨± | èªªæ˜ |
|--------|--------|------|
| ON AIR | RZWD:RADIATION | å°ˆæ¡ˆå“ç‰Œåç¨± |
| PSI | Hzï¼ˆèµ«èŒ²ï¼‰ | åˆ†æ•¸å–®ä½ |
| Outpost | Emitterï¼ˆè¼»å°„æºï¼‰ | NFC ä½”é ˜é» |
| Squad Tactics | RADIATION | å‰¯æ¨™é¡Œ |

---

## ğŸ® éŠæˆ²æ©Ÿåˆ¶

### è§’è‰²ç³»çµ±

#### OCCUPIERï¼ˆä½”é ˜è€…ï¼‰
- **ç›®æ¨™**ï¼šè§¸ç¢°å ´åœ°ä¸­çš„ NFC æ¨™ç±¤ï¼ˆEmitterï¼‰ä¾†ä½”é ˜è¼»å°„æº
- **çå‹µ**ï¼šä½”é ˜çš„è¼»å°„æºæœƒç‚ºåœ˜éšŠæŒçºŒç”¢ç”Ÿ Hz åˆ†æ•¸
- **å¼±é»**ï¼šèƒŒå¾Œæœ‰ QR Codeï¼ˆdorsal_codeï¼‰ï¼Œå¯è¢«æ•µæ–¹ç‹™æ“Šæ‰‹æƒæ
- **é™åˆ¶**ï¼šè¢«å¹²æ“¾ï¼ˆJAMMEDï¼‰æ™‚ç„¡æ³•ä½”é ˜

#### SNIPERï¼ˆç‹™æ“Šæ‰‹ï¼‰
- **æ•¸é‡**ï¼šæ¯éšŠåªæœ‰ 1 ä½
- **ç›®æ¨™**ï¼šä½¿ç”¨ç›¸æ©Ÿæƒææ•µæ–¹ Occupier èƒŒå¾Œçš„ QR Code
- **æ•ˆæœ**ï¼šæƒææˆåŠŸå¾Œï¼Œæ•µäººæœƒè¢«å¹²æ“¾ï¼ˆJAMMEDï¼‰30 ç§’
- **é™åˆ¶**ï¼š
  - ä¸èƒ½ä½”é ˜ NFC é»
  - ä¸èƒ½æ”»æ“Šå‹è»ï¼ˆFriendly Fire Disabledï¼‰

### ç‹€æ…‹ç³»çµ±

```
ACTIVE â†’ æ­£å¸¸ç‹€æ…‹ï¼Œå¯é€²è¡Œæ‰€æœ‰æ“ä½œ
JAMMED â†’ è¢«å¹²æ“¾ç‹€æ…‹ï¼Œç„¡æ³•é€²è¡Œä»»ä½•æ“ä½œï¼ŒæŒçºŒ 30 ç§’
```

ç•¶ç©å®¶è¢« JAMMEDï¼š
1. ç•«é¢é¡¯ç¤ºå…¨è¢å¹•æ•…éšœç‰¹æ•ˆï¼ˆGlitch Overlayï¼‰
2. æ‰‹æ©Ÿéœ‡å‹•
3. å€’æ•¸è¨ˆæ™‚ 30 ç§’
4. æœŸé–“æ‰€æœ‰æ“ä½œè¢«ç¦ç”¨

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### æŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| å‰ç«¯æ¡†æ¶ | Next.js 15 (App Router) |
| èªè¨€ | TypeScript |
| æ¨£å¼ | Tailwind CSS 4 |
| å‹•ç•« | Framer Motion |
| å¾Œç«¯/è³‡æ–™åº« | Supabase (Postgres) |
| èªè­‰ | Supabase Auth |
| å³æ™‚é€šè¨Š | Supabase Realtime |
| NFC å®‰å…¨ | NTAG 424 DNA |

### å°ˆæ¡ˆçµæ§‹

```
squad-tactics/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/game/
â”‚   â”‚   â”œâ”€â”€ capture/route.ts      # NFC ä½”é ˜ API
â”‚   â”‚   â””â”€â”€ snipe/route.ts        # ç‹™æ“Šæ”»æ“Š API
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # éŠæˆ²ä¸»å„€è¡¨æ¿
â”‚   â”‚   â””â”€â”€ snipe/page.tsx        # ç‹™æ“Šæ‰‹æƒæé é¢
â”‚   â”œâ”€â”€ globals.css               # è³½åšæœ‹å…‹ä¸»é¡Œæ¨£å¼
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹ä½ˆå±€
â”‚   â””â”€â”€ page.tsx                  # ç™»å…¥é é¢
â”œâ”€â”€ components/game/
â”‚   â”œâ”€â”€ GlitchOverlay.tsx         # è¢«å¹²æ“¾æ™‚çš„æ•…éšœç‰¹æ•ˆ
â”‚   â””â”€â”€ StatusBadge.tsx           # è§’è‰²/ç‹€æ…‹å¾½ç« 
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useRealtimeProfile.ts     # å³æ™‚å€‹äººè³‡æ–™è¨‚é–±
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ ntag424.ts                # NTAG 424 é©—è­‰å·¥å…· (Mock)
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ client.ts             # å®¢æˆ¶ç«¯ Supabase
â”‚       â””â”€â”€ server.ts             # ä¼ºæœå™¨ç«¯ Supabase
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ schema.sql                # å®Œæ•´è³‡æ–™åº«æ¶æ§‹
â”œâ”€â”€ types/
â”‚   â””â”€â”€ game.ts                   # TypeScript å‹åˆ¥å®šç¾©
â””â”€â”€ middleware.ts                 # èªè­‰ä¸­ä»‹è»Ÿé«”
```

---

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹

### è¡¨æ ¼çµæ§‹

#### `teams` - é™£ç‡Ÿ
```sql
id UUID PRIMARY KEY
name TEXT                    -- é™£ç‡Ÿåç¨± (e.g., "RED PHANTOM", "BLUE SPECTER")
color_hex TEXT               -- é¡è‰²ä»£ç¢¼ (e.g., "#FF2D55")
current_score INTEGER        -- ç•¶å‰ç¸½åˆ† (Hz)
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
```

#### `profiles` - ç©å®¶è³‡æ–™
```sql
id UUID PRIMARY KEY          -- é—œè¯ auth.users
team_id UUID                 -- æ‰€å±¬é™£ç‡Ÿ
role player_role             -- 'OCCUPIER' | 'SNIPER' | 'ADMIN'
status player_status         -- 'ACTIVE' | 'JAMMED'
jam_expires_at TIMESTAMPTZ   -- å¹²æ“¾çµæŸæ™‚é–“
dorsal_code TEXT             -- QR Code å…§å®¹ (e.g., "RZ-ABC123")
display_name TEXT
avatar_url TEXT
total_captures INTEGER       -- ç¸½ä½”é ˜æ¬¡æ•¸
total_snipes INTEGER         -- ç¸½ç‹™æ“Šæ¬¡æ•¸
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
```

#### `outposts` - è¼»å°„æº (Emitters)
```sql
id UUID PRIMARY KEY
uid TEXT                     -- NTAG 424 UID
name TEXT                    -- è¼»å°„æºåç¨± (e.g., "EMITTER-Î±")
location_description TEXT    -- ä½ç½®æè¿°
owning_team_id UUID          -- ç•¶å‰æ§åˆ¶çš„é™£ç‡Ÿ
last_captured_at TIMESTAMPTZ
last_captured_by UUID
hz_per_minute INTEGER        -- æ¯åˆ†é˜ç”¢ç”Ÿçš„ Hz åˆ†æ•¸
is_active BOOLEAN
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
```

#### `combat_logs` - æˆ°é¬¥ç´€éŒ„
```sql
id UUID PRIMARY KEY
sniper_id UUID               -- ç‹™æ“Šæ‰‹
victim_id UUID               -- å—å®³è€…
sniper_team_id UUID
victim_team_id UUID
jam_duration_seconds INTEGER -- å¹²æ“¾æŒçºŒæ™‚é–“
created_at TIMESTAMPTZ
```

#### `capture_logs` - ä½”é ˜ç´€éŒ„
```sql
id UUID PRIMARY KEY
outpost_id UUID              -- è¼»å°„æº
capturer_id UUID             -- ä½”é ˜è€…
team_id UUID                 -- ä½”é ˜å¾Œçš„é™£ç‡Ÿ
previous_team_id UUID        -- ä½”é ˜å‰çš„é™£ç‡Ÿ
created_at TIMESTAMPTZ
```

#### `game_sessions` - éŠæˆ²å›åˆ
```sql
id UUID PRIMARY KEY
name TEXT
status game_status           -- 'PENDING' | 'ACTIVE' | 'PAUSED' | 'ENDED'
started_at TIMESTAMPTZ
ended_at TIMESTAMPTZ
duration_minutes INTEGER
winning_team_id UUID
created_at TIMESTAMPTZ
```

### è‡ªå‹•è§¸ç™¼å™¨

1. **`on_auth_user_created`**ï¼šæ–°ç”¨æˆ¶è¨»å†Šæ™‚è‡ªå‹•å»ºç«‹ profile
2. **`set_profile_dorsal_code`**ï¼šè‡ªå‹•ç”Ÿæˆ dorsal_codeï¼ˆæ ¼å¼ï¼š`RZ-XXXXXX`ï¼‰
3. **`update_updated_at`**ï¼šè‡ªå‹•æ›´æ–° updated_at æ™‚é–“æˆ³

---

## ğŸ”Œ API ç«¯é»

### POST `/api/game/capture`
ä½”é ˜è¼»å°„æºï¼ˆé€é NFCï¼‰

**Request:**
```json
{
  "e": "encrypted-ntag-data",
  "c": "cmac-signature"
}
```

**é©—è­‰é‚è¼¯:**
1. é©—è­‰ NTAG 424 ç°½å
2. æª¢æŸ¥ç©å®¶ç‹€æ…‹ï¼šå¦‚æœ `JAMMED` â†’ éŒ¯èª¤ `"SIGNAL JAMMED"`
3. æª¢æŸ¥è§’è‰²ï¼šå¦‚æœ `SNIPER` â†’ éŒ¯èª¤ `"SNIPERS CANNOT CAPTURE"`
4. æ›´æ–°è¼»å°„æºæ“æœ‰æ¬Š
5. è¨˜éŒ„ä½”é ˜æ—¥èªŒ

**Response:**
```json
{
  "success": true,
  "outpost": { ... },
  "message": "EMITTER-Î± CAPTURED!",
  "captured_from": { "name": "BLUE SPECTER", ... }
}
```

### POST `/api/game/snipe`
ç‹™æ“Šæ”»æ“Š

**Request:**
```json
{
  "dorsal_code": "RZ-ABC123"
}
```

**é©—è­‰é‚è¼¯:**
1. ç¢ºèªå‘¼å«è€…æ˜¯ `SNIPER`
2. é€é `dorsal_code` æ‰¾åˆ°å—å®³è€…
3. å‹è»å‚·å®³æª¢æŸ¥ï¼šåŒéšŠ â†’ éŒ¯èª¤ `"FRIENDLY FIRE"`
4. å…ç–«æª¢æŸ¥ï¼šå·² `JAMMED` â†’ å¿½ç•¥
5. åŸ·è¡Œæ”»æ“Šï¼š
   - è¨­å®š `status = 'JAMMED'`
   - è¨­å®š `jam_expires_at = NOW() + 30s`
   - è¨˜éŒ„æˆ°é¬¥æ—¥èªŒ
   - è§¸ç™¼ Realtime äº‹ä»¶ï¼ˆå—å®³è€…è¨­å‚™éœ‡å‹•ï¼‰

**Response:**
```json
{
  "success": true,
  "victim": {
    "id": "...",
    "display_name": "Agent007",
    "team": { ... }
  },
  "jam_duration": 30,
  "message": "TARGET ELIMINATED - Agent007 JAMMED for 30s"
}
```

---

## ğŸ“¡ å³æ™‚é€šè¨Š (Realtime)

ä½¿ç”¨ Supabase Realtime è¨‚é–±ä»¥ä¸‹è¡¨æ ¼çš„è®Šæ›´ï¼š

| è¡¨æ ¼ | ç”¨é€” |
|------|------|
| `profiles` | ç›£è½è‡ªå·±çš„ç‹€æ…‹è®Šæ›´ï¼ˆè¢«ç‹™æ“Šæ™‚ç«‹å³è§¸ç™¼ UIï¼‰ |
| `outposts` | ç›£è½è¼»å°„æºæ“æœ‰æ¬Šè®Šæ›´ |
| `teams` | ç›£è½åœ˜éšŠåˆ†æ•¸è®Šæ›´ |

### å®¢æˆ¶ç«¯è¨‚é–±ç¯„ä¾‹

```typescript
// hooks/useRealtimeProfile.ts
const channel = supabase
  .channel(`profile:${userId}`)
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'profiles',
    filter: `id=eq.${userId}`,
  }, handleProfileUpdate)
  .subscribe();
```

ç•¶ `status` è®Šç‚º `JAMMED`ï¼š
1. è§¸ç™¼æ‰‹æ©Ÿéœ‡å‹•
2. é¡¯ç¤º GlitchOverlay å…¨è¢å¹•ç‰¹æ•ˆ
3. é–‹å§‹ 30 ç§’å€’æ•¸

---

## ğŸ¨ UI/UX è¨­è¨ˆ

### è¦–è¦ºé¢¨æ ¼
- **ä¸»é¡Œ**ï¼šè³½åšæœ‹å…‹ / ç§‘å¹»
- **ä¸»è‰²èª¿**ï¼šéœ“è™¹é’ (`#00f0ff`)ã€æ´‹ç´… (`#ff00ff`)ã€è­¦å‘Šç´… (`#ff2d55`)
- **èƒŒæ™¯**ï¼šæ·±é»‘ (`#0a0a0f`) + ç¶²æ ¼æ•ˆæœ + æƒæç·šå‹•ç•«

### æ ¸å¿ƒå…ƒä»¶

1. **GlitchOverlay**ï¼šè¢«å¹²æ“¾æ™‚çš„å…¨è¢å¹•æ•…éšœç‰¹æ•ˆ
   - æ•…éšœæ–‡å­—å‹•ç•«
   - æƒæç·šæ•ˆæœ
   - é›œè¨Šç´‹ç†
   - åœ“å½¢å€’æ•¸è¨ˆæ™‚å™¨

2. **StatusBadge**ï¼šé¡¯ç¤ºç©å®¶è§’è‰²å’Œç‹€æ…‹
   - é™£ç‡Ÿå¾½ç« ï¼ˆå¸¶é¡è‰²ï¼‰
   - è§’è‰²åœ–ç¤ºï¼ˆSNIPER/OCCUPIERï¼‰
   - ç‹€æ…‹æŒ‡ç¤ºç‡ˆï¼ˆç¶ è‰²=ACTIVEï¼Œç´…è‰²é–ƒçˆ=JAMMEDï¼‰

3. **Scanner HUD**ï¼šç‹™æ“Šæ‰‹ç„æº–ä»‹é¢
   - åå­—æº–å¿ƒ
   - è§’è½æ‹¬è™Ÿ
   - ç›¸æ©Ÿè¦–åœ–

---

## ğŸ” å®‰å…¨æ©Ÿåˆ¶

### NTAG 424 DNA
- NFC æ¨™ç±¤ä½¿ç”¨ AES-128 åŠ å¯†
- æ¯æ¬¡è§¸ç¢°ç”¢ç”Ÿå”¯ä¸€ç°½åï¼Œé˜²æ­¢é‡æ”¾æ”»æ“Š
- ç›®å‰ç‚º Mock å¯¦ä½œï¼Œç”Ÿç”¢ç’°å¢ƒéœ€å®Œæ•´é©—è­‰

### Row Level Security (RLS)
- æ‰€æœ‰è¡¨æ ¼å•Ÿç”¨ RLS
- ç”¨æˆ¶åªèƒ½æ›´æ–°è‡ªå·±çš„ profile
- åªæœ‰ ADMIN å¯ä»¥ç®¡ç†ç³»çµ±è¨­å®š
- åªæœ‰ SNIPER å¯ä»¥å»ºç«‹ combat_logs
- åªæœ‰ OCCUPIER å¯ä»¥å»ºç«‹ capture_logs

---

## ğŸ“¦ å¾…å¯¦ä½œåŠŸèƒ½

- [ ] QR Code å³æ™‚æƒæï¼ˆæ•´åˆ `@yudiel/react-qr-scanner`ï¼‰
- [ ] NTAG 424 DNA å®Œæ•´é©—è­‰
- [ ] åˆ†æ•¸è¨ˆç®— Cron Jobï¼ˆæ¯åˆ†é˜æ›´æ–°åœ˜éšŠ Hz åˆ†æ•¸ï¼‰
- [ ] ç®¡ç†å“¡å¾Œå°
- [ ] éŠæˆ²å›åˆç®¡ç†
- [ ] æˆ°ç¸¾æ’è¡Œæ¦œ
- [ ] éŸ³æ•ˆç³»çµ±

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´
```bash
cd squad-tactics
npm install
```

### 2. è¨­å®šç’°å¢ƒè®Šæ•¸
å»ºç«‹ `.env.local`ï¼š
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
```

### 3. è¨­å®š Supabase
1. å»ºç«‹å°ˆæ¡ˆ
2. åœ¨ SQL Editor åŸ·è¡Œ `supabase/schema.sql`
3. åœ¨ Database > Replication å•Ÿç”¨ Realtimeï¼ˆprofiles, outposts, teamsï¼‰

### 4. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
```bash
npm run dev
```

---

## ğŸ“ TypeScript å‹åˆ¥

ä¸»è¦å‹åˆ¥å®šç¾©åœ¨ `types/game.ts`ï¼š

```typescript
type PlayerRole = 'OCCUPIER' | 'SNIPER' | 'ADMIN';
type PlayerStatus = 'ACTIVE' | 'JAMMED';
type GameStatus = 'PENDING' | 'ACTIVE' | 'PAUSED' | 'ENDED';

interface Profile {
  id: string;
  team_id: string | null;
  role: PlayerRole;
  status: PlayerStatus;
  jam_expires_at: string | null;
  dorsal_code: string;
  display_name: string | null;
  total_captures: number;
  total_snipes: number;
  team?: Team;
}

interface Outpost {
  id: string;
  uid: string;
  name: string;
  owning_team_id: string | null;
  hz_per_minute: number;  // ä½¿ç”¨ Hz ä½œç‚ºåˆ†æ•¸å–®ä½
  is_active: boolean;
  owning_team?: Team;
}
```

---

## ğŸ”„ ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´ |
|------|------|------|
| 0.1.0-alpha | 2026-01-25 | åˆå§‹æ¶æ§‹å»ºç«‹ |
| 0.1.1-alpha | 2026-01-25 | å“ç‰Œæ›´åç‚º RZWD:RADIATIONï¼Œåˆ†æ•¸å–®ä½æ”¹ç‚º Hz |

---

*æ­¤æ–‡ä»¶æœ€å¾Œæ›´æ–°ï¼š2026-01-25*
